<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Licencia Interna CONDUCE-MEP</title>
<style>
:root {
  --azul-oscuro: #004d9c;
  --azul-medio: #007bff;
  --naranja: #ff8c00;
  --rojo: #d9534f;
  --gris-fondo: #f5f5f5;
}

/* ======== CONFIGURACI√ìN GENERAL ======== */
body {
  font-family: Arial, sans-serif;
  background-color: var(--gris-fondo);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  gap: 25px;
  padding: 25px;
  font-size: 13px;
  margin: 0;
}

/* Para impresi√≥n en hoja A4 */
@page {
  size: A4;
  margin: 10mm;
}
@media print {
  
  body {
    background: white;
    gap: 20px;
  }
  .tarjeta {
    box-shadow: none;
    border: 1px solid #999;
  }
}

/* ======== TARJETA BASE ======== */
.tarjeta {
  width: 170mm;
  height: 108mm;
  background-color: #fff;
  border: 1px solid #ccc;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.15);
  box-sizing: border-box;
  padding: 15px 18px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  overflow: hidden;
}
.tarjeta.cara-posterior {
  padding-bottom: 15px;
}

/* ======== CARA FRONTAL ======== */
.encabezado {
  display: flex;
  align-items: center;
  border-bottom: 2px solid #ccc;
  padding-bottom: 8px;
  gap: 15px;
}

.logo-espacio {
  width: 85px;
  height: 85px;
  border: 1px solid #ddd;
  border-radius: 6px;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #fff;
  flex-shrink: 0;
}
.logo-espacio img {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

.titulo-area {
  flex: 1;
  border-left: 3px solid var(--azul-oscuro);
  padding-left: 15px;
}
.titulo-area h2 {
  margin: 0;
  font-size: 26px;
  color: var(--azul-oscuro);
}
.titulo-area p {
  margin: 0;
  font-size: 14px;
  color: var(--azul-oscuro);
  font-weight: bold;
  padding-top: 5px;
}

/* ======== CUERPO ======== */
.cuerpo {
  display: flex;
  gap: 15px;
  margin-top: 12px;
  flex-wrap: nowrap;
}

.foto {
  width: 120px;
  height: 155px;
  border: 2px solid #333;
  border-radius: 6px;
  overflow: hidden;
  text-align: center;
  background-color: #eee;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  flex-shrink: 0;
}
.foto input {
  position: absolute;
  opacity: 0;
  width: 100%;
  height: 100%;
  cursor: pointer;
}
.foto img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: none;
}

.datos {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
}

.nombre-completo input {
  width: 100%;
  font-size: 18px;
  font-weight: bold;
  color: var(--azul-oscuro);
  border: none;
  border-bottom: 3px solid var(--azul-oscuro);
  margin-bottom: 8px;
  background: none;
  text-transform: uppercase;
  box-sizing: border-box;
}

.datos-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  column-gap: 10px;
  row-gap: 6px;
  width: 100%;
  box-sizing: border-box;
}

.campo {
  display: flex;
  align-items: center;
  gap: 6px;
}
.campo label {
  width: 90px;
  font-weight: bold;
  color: #444;
  font-size: 13px;
  flex-shrink: 0;
}
.campo input {
  flex: 1;
  width: 100%;
  border: 2px solid #ccc;
  background-color: #fffde7;
  padding: 3px 5px;
  border-radius: 4px;
  height: 25px;
  font-size: 13px;
  box-sizing: border-box;
}


.caducidad input {
  background-color: #ff4c4c !important;   /* Rojo brillante */
  color: #ffffff !important;              /* Texto blanco */
  font-weight: bold;
  border: 2px solid #d32f2f;
  border-radius: 4px;
  text-align: center;
  -webkit-appearance: none;               /* Elimina estilo por defecto de Chrome */
  appearance: none;
}

.caducidad-interna input {
  background-color: #ff9800 !important;   /* Naranja intenso */
  color: #ffffff !important;
  font-weight: bold;
  border: 2px solid #e68900;
  border-radius: 4px;
  text-align: center;
  -webkit-appearance: none;
  appearance: none;
}


/* ======== PIE (OBRA) ======== */
.obra {
  border-top: 1px solid #ccc;
  font-size: 11px;
  text-align: center;
  padding-top: 5px;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-wrap: wrap;
}
.obra strong {
  margin-right: 5px;
  font-size: 14px;
  color: var(--azul-oscuro);
  font-weight: bold;
  text-transform: uppercase;
}

.obra input {
  width: 80%; /* un poco m√°s ancho */
  margin: 0 5px;
  border: 2px solid #999; /* borde m√°s visible */
  background-color: #fffde7;
  padding: 5px; /* m√°s alto */
  font-size: 15px; /* texto m√°s grande */
  text-align: center;
  font-weight: bold; /* resalta el nombre */
  border-radius: 4px;
  flex-grow: 1;
}

.obra .nota-inferior {
  width: 100%;
  margin-top: 5px;
  font-size: 10px;
}

/* ======== CARA POSTERIOR ======== */
.cara-posterior h3 {
  background-color: var(--azul-oscuro);
  color: white;
  font-size: 16px;
  text-align: center;
  margin: 0 0 8px 0;
  padding: 6px;
  border-radius: 4px;
}

.tabla-autorizacion {
  width: 100%;
  border-collapse: collapse;
  font-size: 11px;
}
.tabla-autorizacion th {
  background-color: var(--azul-oscuro);
  color: white;
  padding: 5px 3px;
  text-align: center;
  border: 1px solid #ccc;
  height: 35px;
  font-size: 13px;
  vertical-align: middle;
}
.tabla-autorizacion th input {
  width: 95%;
  background-color: white;
  color: var(--azul-oscuro);
  border: 1px solid #ccc;
  padding: 3px;
  margin-top: 3px;
  font-size: 11px;
  text-align: center;
  box-sizing: border-box;
}
.tabla-autorizacion td {
  border: 1px solid #ccc;
  padding: 2px 3px;
  vertical-align: top;
  line-height: 1.2;
}
.tabla-autorizacion .col-modelo {
  width: 10%;
  font-weight: bold;
  text-align: center;
  background-color: #f0f0f0;
}
.tabla-autorizacion td input {
  width: 100%;
  border: none;
  background-color: #fffde7;
  font-size: 11px;
  padding: 0;
  box-sizing: border-box;
  text-align: center;
}

/* ======== PIE POSTERIOR (Firmas) ======== */
.pie-posterior {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 10px;
  margin-top: 10px;
}

.bloque-izquierdo-autorizacion {
  display: flex;
  flex-direction: column;
  width: 50%;
  gap: 5px;
  font-size: 12px;
}

.caja-azul-autorizacion {
  background-color: var(--azul-oscuro);
  color: white;
  padding: 3px 5px;
  font-size: 12px;
  font-weight: bold;
  text-align: center;
  margin-top: 3px;
}
.bloque-izquierdo-autorizacion p {
  margin: 0;
  font-size: 11px;
  text-align: center;
}
.bloque-izquierdo-autorizacion input {
  width: 100%;
  border: none;
  border-bottom: 1px dashed #333;
  text-align: center;
  background-color: transparent;
  font-size: 12px;
}

/* Firma SSOMA */
.firma-ssoma {
  width: 50%;
  border: 1px solid black;
  padding: 5px;
  height: 100px;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  align-items: center;
  font-size: 10px;
  position: relative;
}
.firma-imagen {
  max-width: 100%;
  max-height: 90%;
  object-fit: contain;
  position: absolute;
  top: 2%;
  left: 50%;
  transform: translateX(-50%);
}
.firma-ssoma .sello-area {
  flex-grow: 1;
  width: 100%;
  text-align: center;
  margin-bottom: 5px;
}
.firma-ssoma p {
  margin: 0;
  line-height: 1.1;
}
.firma-ssoma strong {
  font-size: 11px;
}

/* Barra azul inferior */
.nota-final-bar {
  background-color: var(--azul-oscuro);
  color: white;
  font-weight: bold;
  text-align: center;
  padding: 5px;
  font-size: 11px;
  border-radius: 0 0 10px 10px;
  margin: 10px -18px -15px -18px;
}


  /* Ajustar m√°rgenes para que el carnet ocupe la hoja */
  body {
    background: white;
    margin: 0;
    padding: 0;
  }

  /* Quitar sombra y borde visible en impresi√≥n */
  .tarjeta {
    box-shadow: none !important;
    border: 1px solid #999 !important;
  }


@media print {
  /* Forzar impresi√≥n de fondos y colores exactos */
  * {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
    color-adjust: exact !important;
  }

  /* Colores de fondo s√≥lidos */
  .caducidad input {
    background-color: #d9534f !important; /* rojo */
    color: #fff !important;
    font-weight: bold;
    border: 2px solid #b52b27 !important;
  }

  .caducidad-interna input {
    background-color: #ff9800 !important; /* naranja */
    color: #fff !important;
    font-weight: bold;
    border: 2px solid #cc7a00 !important;
  }

  /* Fondo blanco general */
  body {
    background: #fff !important;
  }

  /* Quitar sombras y bordes */
  .tarjeta {
    box-shadow: none !important;
    border: 1px solid #999 !important;
  }

  /* Ocultar botones, buscadores, t√≠tulos extras */
   #btn-buscar,
  #btn-imprimir,
  #buscar-dni,
  #resultado-busqueda,
  hr,
  h3:not(.titulo-posterior) {
    display: none !important;
  }
}

.titulo-imagen {
  max-width: 100%;  /* Se ajusta al ancho del contenedor */
  height: auto;     /* Mantiene proporci√≥n */
  display: block;
  margin-bottom: 5px;
}




</style>
</head>

<body>
  

<hr>
<h3>üîç Buscar registro</h3>
<input type="text" id="buscar-dni" placeholder="Ingrese DNI">
<button id="btn-buscar">Buscar</button>


<div id="resultado-busqueda" style="margin-top: 10px;"></div>



<div class="tarjeta cara-frontal">
  <div class="encabezado">
    <div class="logo-espacio">
      <img src="IMG/logo_mota_engil.jpg" alt="LOGO">
    </div>
    <div class="titulo-area">
       <img src="img/logo_conducemep.jpeg" alt="Licencia CONDUCE-MEP" class="titulo-imagen">

      <p>√ÅREA DE CAPACITACI√ìN Y ENTRENAMIENTO - EQUIPOS</p>
    </div>
  </div>

  <div class="cuerpo">
    <div class="foto">
      <input type="file" id="foto-input" accept="image/*">
      <span>Subir foto</span>
      <img id="foto-preview" alt="Foto del operador">
    </div>
    <div class="datos">
      <div class="nombre-completo">
        <input type="text" name="nombre_completo" placeholder="NOMBRE COMPLETO DEL OPERADOR">
      </div>
      <div class="datos-grid">
        <div class="campo"><label>DNI:</label><input type="text" name="dni"></div>
        <div class="campo"><label>Lic. Conducir:</label><input type="text" name="lic_conducir_categoria" placeholder="A-IIIc"></div>
        <div class="campo"><label>Emisi√≥n:</label><input type="date" name="lic_conducir_emision"></div>
        <div class="campo caducidad"><label>Caducidad:</label><input type="date" name="lic_conducir_caducidad"></div>
        <div class="campo"><label>ID Licencia:</label><input type="text" name="licencia_id" placeholder="EQUI-MEP-LIQ-XXX"></div>
        <div class="campo"><label>Cargo/√Årea:</label><input type="text" name="cargo_area"></div>
        <div class="campo"><label>Lic. Interna:</label><input type="date" name="lic_interna_emision"></div>
        <div class="campo caducidad-interna"><label>Cad. Interna:</label><input type="text" name="lic_interna_caducidad" value="T√©rm. obra"></div>
      </div>
    </div>
  </div>

  <div class="obra">
    <strong>V√ÅLIDO SOLO PARA LA OBRA:</strong>
    <input type="text" name="obra_valida" placeholder="Nombre de la obra">
    <span class="nota-inferior">OBLIGATORIO SU PORTABILIDAD AL OPERAR UN EQUIPO O VEH√çCULO - MEP</span>
  </div>

  <div class="nota-final-bar">
    NO OPERE UN EQUIPO SIN AUTORIZACI√ìN
  </div>

</div>

<div class="tarjeta cara-posterior">
  <h3 class="titulo-posterior">AUTORIZACIONES DE OPERACI√ìN Y CONDUCCI√ìN</h3>
  <table class="tabla-autorizacion">
    <thead>
      <tr>
        <th class="col-modelo">Modelo</th>
        <th>EQUIPO 1<br><input type="text" name="titulo_eq1" placeholder="Ej: VOLQUETE"></th>
        <th>EQUIPO 2<br><input type="text" name="titulo_eq2" placeholder="Ej: MIXER"></th>
        <th>EQUIPO 3<br><input type="text" name="titulo_eq3" placeholder="Ej: CAMI√ìN"></th>
      </tr>
    </thead>
    <tbody>
      <tr><td class="col-modelo">Modelo 1</td><td><input name="eq1_m1"></td><td><input name="eq2_m1"></td><td><input name="eq3_m1"></td></tr>
      <tr><td class="col-modelo">Modelo 2</td><td><input name="eq1_m2"></td><td><input name="eq2_m2"></td><td><input name="eq3_m2"></td></tr>
      <tr><td class="col-modelo">Modelo 3</td><td><input name="eq1_m3"></td><td><input name="eq2_m3"></td><td><input name="eq3_m3"></td></tr>
      <tr><td class="col-modelo">Modelo 4</td><td><input name="eq1_m4"></td><td><input name="eq2_m4"></td><td><input name="eq3_m4"></td></tr>
      <tr><td class="col-modelo">Modelo 5</td><td><input name="eq1_m5"></td><td><input name="eq2_m5"></td><td><input name="eq3_m5"></td></tr>
      <tr><td class="col-modelo">Modelo 6</td><td><input name="eq1_m6"></td><td><input name="eq2_m6"></td><td><input name="eq3_m6"></td></tr>
      <tr><td class="col-modelo">Modelo 7</td><td><input name="eq1_m7"></td><td><input name="eq2_m7"></td><td><input name="eq3_m7"></td></tr>
    </tbody>
  </table>

<!-- PIE POSTERIOR (FIRMAS + TEXTOS ALINEADOS) -->
<!-- PIE POSTERIOR (FIRMAS SIN TEXTOS, FIRMAS GRANDES) -->
<div class="pie-posterior" style="flex-direction: column; align-items: stretch; gap: 6px; margin-top: 10px;">

  <!-- FIRMAS EN DOS COLUMNAS -->
  <div style="display: flex; justify-content: space-between; align-items: center; gap: 10px;">
    
    <!-- Firma izquierda -->
    <div style="width: 48%; text-align: center;">
      <div class="caja-azul-autorizacion">Jefe de SSOMA</div>
      <div style="border:1px solid #999; border-top:none; padding:4px; height:90px; display:flex; align-items:center; justify-content:center;">
        <img src="img/firma.jpeg" alt="Firma Jefe SSOMA" style="width:90%; max-height:80px; object-fit:contain;">
      </div>
    </div>

    <!-- Firma derecha -->
    <div style="width: 48%; text-align: center;">
      <div class="caja-azul-autorizacion">Resp. de emisi√≥n de licencias</div>
      <div style="border:1px solid #999; border-top:none; padding:4px; height:90px; display:flex; align-items:center; justify-content:center;">
        <img src="img/firma.jpeg" alt="Firma Responsable" style="width:90%; max-height:80px; object-fit:contain;">
      </div>
    </div>

  </div>

  <!-- TEXTO ROJO CENTRADO DEBAJO DE AMBAS FIRMAS -->
  <p style="color:red; font-weight:bold; font-size:11px; text-align:center; margin:2px 0 -6px 0; line-height:1;">
  PROHIBIDO OPERAR UN EQUIPO QUE NO SE DETALLE EN ESTA LICENCIA
</p>
</div>

  <div class="nota-final-bar">
    OBLIGATORIO ENTREGAR LA LICENCIA AL T√âRMINO DEL V√çNCULO CON MEP
  </div>
</div>

<script>
document.getElementById('foto-input').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(ev) {
    const img = document.getElementById('foto-preview');
    img.src = ev.target.result;
    img.style.display = 'block';
    document.querySelector('.foto span').style.display = 'none';
  };
  reader.readAsDataURL(file);
});
</script>






<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwZpw_QTHGDcwxuL92y36UCZANRRr6f2Aa6CmYHL0MwL0c_NIsmjboDaMhje79DZABM/exec";


</script>



<script>

// === FUNCI√ìN PARA RENDERIZAR TABLA ===
function mostrarTabla(datos, titulo) {
  const cont = document.getElementById("resultado-busqueda");
  cont.innerHTML = `<h4>${titulo}</h4>`;

  if (datos.length === 0) {
    cont.innerHTML += "<p>No se encontraron registros.</p>";
    return;
  }

  const tabla = document.createElement("table");
  tabla.border = "1";
  tabla.style.borderCollapse = "collapse";
  tabla.style.marginTop = "10px";
  tabla.innerHTML = `
    <tr>
      <th>Fecha</th>
      <th>DNI</th>
      <th>Nombre</th>
      <th>Categor√≠a</th>
      <th>Equipo</th>
      <th>Marca</th>
      <th>Modelo</th>
      <th>Acciones</th>
    </tr>
  `;

  datos.forEach(r => {
    const fila = document.createElement("tr");
    fila.innerHTML = `
      <td>${new Date(r.fecha).toLocaleDateString()}</td>
      <td><input value="${r.dni}" style="width:80px"></td>
      <td><input value="${r.nombre}" style="width:130px"></td>
      <td><input value="${r.categoria}" style="width:60px"></td>
      <td><input value="${r.equipo}" style="width:90px"></td>
      <td><input value="${r.marca}" style="width:90px"></td>
      <td><input value="${r.modelo}" style="width:90px"></td>
      <td><button onclick="guardarEdicion(${r.row}, this)">üíæ</button></td>
    `;
    tabla.appendChild(fila);
  });

  cont.appendChild(tabla);
}


//FUNCION BUSCAR

document.getElementById("btn-buscar").addEventListener("click", async () => {
  const dni = document.getElementById("buscar-dni").value.trim();
  if (!dni) return alert("Ingrese un DNI para buscar.");

  try {
    const TOKEN = "MEP123"; // mismo que en Apps Script

  const resp = await fetch(SCRIPT_URL, {
  method: "POST",
  body: JSON.stringify({ action: "buscar", dni, token: TOKEN }),
  });

    const data = await resp.json();
    console.log("Datos recibidos:", data);

    if (data.length === 0) {
      alert("‚ö†Ô∏è No se encontr√≥ ning√∫n registro para ese DNI.");
      return;
    }

    // --- Rellenar datos generales del operador (usa el primer registro)
    const r = data[0];
    document.querySelector('[name="nombre_completo"]').value = r.nombre || "";
    document.querySelector('[name="dni"]').value = r.dni || "";
    document.querySelector('[name="lic_conducir_categoria"]').value = r.categoria || "";
    document.querySelector('[name="lic_conducir_emision"]').value = r.fechaEmision || "";
    document.querySelector('[name="lic_conducir_caducidad"]').value = r.fechaCaducidad || "";
    document.querySelector('[name="licencia_id"]').value = r.idLicencia || "";
    document.querySelector('[name="cargo_area"]').value = r.cargo || "";
    document.querySelector('[name="lic_interna_emision"]').value = r.fechaEmisionInterna || "";
    document.querySelector('[name="lic_interna_caducidad"]').value = r.fechaCaducidadInterna || "";
    document.querySelector('[name="obra_valida"]').value = r.obra || "";
    //document.querySelector('input[placeholder="Nombre Jefe SSOMA"]').value = r.jefeSSOMA || "";
    //document.querySelector('input[placeholder="√Årea de Capacitaci√≥n y Entrenamiento"]').value = r.responsableEmision || "";

    // --- Limpiar antes de rellenar
    for (let fila = 1; fila <= 7; fila++) {
      for (let col = 1; col <= 3; col++) {
        document.querySelector(`[name="eq${col}_m${fila}"]`).value = "";
      }
      document.querySelector(`[name="titulo_eq${fila}"]`);
    }

    // --- Rellenar los equipos y sus modelos
    data.forEach((eq, index) => {
      const col = index + 1; // hasta 3 equipos (columna 1 a 3)
      if (col > 3) return; // solo muestra los tres primeros

      // t√≠tulo del equipo
      document.querySelector(`[name="titulo_eq${col}"]`).value = eq.equipo || "";

      // modelos del 1 al 7
      for (let fila = 1; fila <= 7; fila++) {
        const valor = eq[`modelo${fila}`] || "";
        document.querySelector(`[name="eq${col}_m${fila}"]`).value = valor;
      }
    });

    alert("‚úÖ Datos cargados correctamente.");
  } catch (err) {
    alert("‚ùå Error al buscar: " + err);
  }
});


</script>


<!-- ====== BOT√ìN DE IMPRESI√ìN ====== -->
<button id="btn-imprimir" style="
  background-color: var(--azul-oscuro);
  color: white;
  font-weight: bold;
  padding: 8px 16px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  margin-top: 15px;
">üñ®Ô∏è Imprimir Carnet</button>

<script>
// === MODO SOLO VISUALIZACI√ìN ===
function activarSoloLectura() {
  const inputs = document.querySelectorAll('input:not([type="file"])');
  inputs.forEach(inp => {
    // Excluir el buscador de DNI y los botones
    if (inp.id === "buscar-dni") return;

    inp.setAttribute("readonly", true);
    inp.style.backgroundColor = "#f5f5f5";
    inp.style.pointerEvents = "none";
  });

  // Permitir solo cambiar la foto
  const fotoInput = document.getElementById("foto-input");
  fotoInput.removeAttribute("disabled");
  fotoInput.style.pointerEvents = "auto";
}
// === IMPRIMIR CARNET ===
document.getElementById("btn-imprimir").addEventListener("click", () => {
  window.print();
});

// Activar modo visualizaci√≥n despu√©s de cargar datos
document.addEventListener("DOMContentLoaded", activarSoloLectura);
</script>



</body>
</html>